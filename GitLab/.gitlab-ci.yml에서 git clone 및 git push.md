# .gitlab-ci.yml에서 git clone 및 git push

<br>

## 요구 사항
- **(선택)test_group 생성**
- **test_group 밑에 Project 2개(test_project_src, test_project_dest) 생성**
- **Personal Access Token 생성 - write_repository 권한**
- **CI/CD 환경변수 등록 - ACCESS_TOKEN**

<br>

## 전제 조건
- test_project_src에 gitlab runner 등록

<hr>

## Source Projcet(test_projcet_src)에 `.gitlab-ci.yml` 파일 작성

### `.gitlab-ci.yml`
```yaml
image: alpine:latest
stages:
  - deploy

workflow:
  rules:
    - changes:
      - .gitlab-ci.yml

variables:
  dest: test_project_dest

deploy:
  stage: deploy
  tags:
    - SharedRunner
  before_script:
    - apk add git
    - git config --global user.email "gitlab@noreply.gitlab.example.com" && git config --global user.name "gitlab-ci runner"
  script:
    - git clone https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.example.com/test_group/$dest.git && cd $dest
    - touch test.txt
    - git add test.txt && git commit -m "Gitlab-CI runner $CI_COMMIT_SHORT_SHA"
    - git push "https://gitlab-ci-token:${ACCESS_TOKEN}@gitlab.example.com/test_group/$dest.git" main
```

<br>

## Destination Project(test_project_dest)에서 push된 내용 확인
![image](https://user-images.githubusercontent.com/46125158/184539615-5b4d2932-0acf-40e1-8215-b434d09d93c6.png)

<hr>

## 참고
- **CI_JOB_TOKEN** - https://docs.gitlab.com/ee/ci/jobs/ci_job_token.html
- **Predefined variables reference** - https://docs.gitlab.com/ee/ci/variables/predefined_variables.html
- **Personal access token scopes** - https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#personal-access-token-scopes
